<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MauiFirstUartApp.Views.SettingPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="SettingPage">

    <ScrollView>
        <VerticalStackLayout
            Padding="16"
            MaximumWidthRequest="800"
            Spacing="16">

            <!--  Header  -->
            <HorizontalStackLayout Spacing="8">
                <Image
                    HeightRequest="24"
                    Source="settings_icon.png"
                    WidthRequest="24" />
                <Label
                    FontAttributes="Bold"
                    FontSize="24"
                    Text="설정" />
            </HorizontalStackLayout>

            <!--  Serial Port Settings  -->
            <Frame
                Padding="16"
                BackgroundColor="White"
                BorderColor="{StaticResource Gray200}"
                CornerRadius="12"
                HasShadow="False">
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="8">
                        <Image
                            HeightRequest="20"
                            Source="cable_icon.png"
                            WidthRequest="20" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="16"
                            Text="시리얼 포트 설정" />
                    </HorizontalStackLayout>
                    <Label
                        FontSize="12"
                        Text="일반 시리얼 통신 및 모드버스 RTU/ASCII에 공통으로 사용됩니다."
                        TextColor="{StaticResource Gray600}" />

                    <!--  Port Selection  -->
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontSize="12"
                            Text="포트" />
                        <Picker ItemsSource="{Binding PortNames}" SelectedItem="{Binding SelectedPort}" />
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Baud Rate  -->
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontSize="12"
                            Text="Baud Rate" />
                        <Entry Keyboard="Numeric" Text="{Binding BaudRate}" />
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Data Bits & Stop Bits  -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <VerticalStackLayout Spacing="8">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="Data Bits" />
                            <Entry Keyboard="Numeric" Text="{Binding DataBits}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1" Spacing="8">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="Stop Bits" />
                            <Picker ItemsSource="{Binding StopBitsOptions}" SelectedItem="{Binding SelectedStopBits}" />
                        </VerticalStackLayout>
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Parity  -->
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontSize="12"
                            Text="Parity" />
                        <Picker ItemsSource="{Binding ParityOptions}" SelectedItem="{Binding SelectedParity}" />
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  RTS Enable  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="RTS 활성화" />
                            <Label
                                FontSize="11"
                                Text="Request To Send"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsRtsEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  DTR Enable  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="DTR 활성화" />
                            <Label
                                FontSize="11"
                                Text="Data Terminal Ready"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsDtrEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!--  Modbus Settings  -->
            <Frame
                Padding="16"
                BackgroundColor="White"
                BorderColor="{StaticResource Gray200}"
                CornerRadius="12"
                HasShadow="False">
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="8">
                        <Image
                            HeightRequest="20"
                            Source="network_icon.png"
                            WidthRequest="20" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="16"
                            Text="모드버스 설정" />
                    </HorizontalStackLayout>

                    <!--  Protocol  -->
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontSize="12"
                            Text="프로토콜" />
                        <Picker
                            ItemsSource="{Binding ModbusProtocolOptions}"
                            SelectedIndexChanged="OnModbusProtocolChanged"
                            SelectedItem="{Binding SelectedModbusProtocol}" />
                        <Label
                            FontSize="10"
                            Text="시리얼 포트를 통한 통신 (위의 시리얼 포트 설정 사용)"
                            TextColor="{StaticResource Gray600}" />
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Slave ID  -->
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontSize="12"
                            Text="슬레이브 ID" />
                        <Entry Keyboard="Numeric" Text="{Binding ModbusSlaveId}" />
                        <Label
                            FontSize="10"
                            Text="통신할 장치의 주소 (1-247)"
                            TextColor="{StaticResource Gray600}" />
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Timeout  -->
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontSize="12"
                            Text="타임아웃 (ms)" />
                        <Entry Keyboard="Numeric" Text="{Binding ModbusTimeout}" />
                        <Label
                            FontSize="10"
                            Text="응답 대기 시간"
                            TextColor="{StaticResource Gray600}" />
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Auto Reconnect  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="자동 재연결" />
                            <Label
                                FontSize="11"
                                Text="연결 끊김 시 자동 재연결"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsAutoReconnectEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  CRC Verification  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="CRC 검증" />
                            <Label
                                FontSize="11"
                                Text="데이터 무결성 검증 (RTU only)"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsCrcVerificationEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!--  General Settings  -->
            <Frame
                Padding="16"
                BackgroundColor="White"
                BorderColor="{StaticResource Gray200}"
                CornerRadius="12"
                HasShadow="False">
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="8">
                        <Image
                            HeightRequest="20"
                            Source="globe_icon.png"
                            WidthRequest="20" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="16"
                            Text="일반" />
                    </HorizontalStackLayout>

                    <!--  Language  -->
                    <Grid ColumnDefinitions="*,140">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="언어" />
                            <Label
                                FontSize="11"
                                Text="앱 표시 언어"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Picker
                            Grid.Column="1"
                            ItemsSource="{Binding LanguageOptions}"
                            SelectedItem="{Binding SelectedLanguage}" />
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Dark Mode  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="다크 모드" />
                            <Label
                                FontSize="11"
                                Text="어두운 테마 사용"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsDarkModeEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!--  Notification Settings  -->
            <Frame
                Padding="16"
                BackgroundColor="White"
                BorderColor="{StaticResource Gray200}"
                CornerRadius="12"
                HasShadow="False">
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="8">
                        <Image
                            HeightRequest="20"
                            Source="bell_icon.png"
                            WidthRequest="20" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="16"
                            Text="알림" />
                    </HorizontalStackLayout>

                    <!--  Connection Notification  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="연결 알림" />
                            <Label
                                FontSize="11"
                                Text="연결 상태 변경 시 알림"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsConnectionNotificationEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Error Notification  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="오류 알림" />
                            <Label
                                FontSize="11"
                                Text="통신 오류 발생 시 알림"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsErrorNotificationEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Sound Notification  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="소리 알림" />
                            <Label
                                FontSize="11"
                                Text="알림 소리 재생"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsSoundNotificationEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!--  Data Settings  -->
            <Frame
                Padding="16"
                BackgroundColor="White"
                BorderColor="{StaticResource Gray200}"
                CornerRadius="12"
                HasShadow="False">
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="8">
                        <Image
                            HeightRequest="20"
                            Source="database_icon.png"
                            WidthRequest="20" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="16"
                            Text="데이터" />
                    </HorizontalStackLayout>

                    <!--  Auto Save Logs  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="로그 자동 저장" />
                            <Label
                                FontSize="11"
                                Text="통신 로그 자동으로 저장"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsAutoSaveLogsEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Log Retention  -->
                    <Grid ColumnDefinitions="*,140">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="로그 보관 기간" />
                            <Label
                                FontSize="11"
                                Text="로그 파일 보관 기간"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Picker
                            Grid.Column="1"
                            ItemsSource="{Binding LogRetentionOptions}"
                            SelectedItem="{Binding SelectedLogRetention}" />
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  Timestamp Display  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="타임스탬프 표시" />
                            <Label
                                FontSize="11"
                                Text="로그에 시간 정보 표시"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsTimestampDisplayEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                    <!--  HEX Format  -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="12"
                                Text="HEX 형식 표시" />
                            <Label
                                FontSize="11"
                                Text="데이터를 16진수로 표시"
                                TextColor="{StaticResource Gray600}" />
                        </VerticalStackLayout>
                        <Switch
                            Grid.Column="1"
                            IsToggled="{Binding IsHexFormatEnabled}"
                            OnColor="{StaticResource YellowPrimary}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
